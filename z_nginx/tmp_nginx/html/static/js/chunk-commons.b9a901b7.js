(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-commons"],{"0dcf":function(e,t,i){"use strict";i("f559"),i("7f7f");var n=function(){var e=this,t=e._self._c;return t("span",[e.item.isFavorite&&!e.public?t("div",[e.pc?t("div",[e.grid?e._e():t("svg-icon",{staticClass:"pc list icon-favorite",attrs:{"icon-class":"Favoritestarrate"}}),e._v(" "),e.grid?t("svg-icon",{staticClass:"pc grid icon-favorite",attrs:{"icon-class":"Favoritestarrate"}}):e._e()],1):t("div",[e.grid?e._e():t("svg-icon",{staticClass:"mobile list icon-favorite",attrs:{"icon-class":"Favoritestarrate"}}),e._v(" "),e.grid?t("svg-icon",{staticClass:"mobile grid icon-favorite",attrs:{"icon-class":"Favoritestarrate"}}):e._e()],1)]):e._e(),e._v(" "),e.item.isShare&&e.item.shareBase&&!e.public?t("div",[e.pc?t("div",[e.grid?e._e():t("svg-icon",{staticClass:"pc list icon-share",attrs:{"icon-class":"share"}}),e._v(" "),e.grid?t("svg-icon",{staticClass:"pc grid icon-share",attrs:{"icon-class":"share"}}):e._e()],1):t("div",[e.grid?e._e():t("svg-icon",{staticClass:"mobile list icon-share",attrs:{"icon-class":"share"}}),e._v(" "),e.grid?t("svg-icon",{staticClass:"mobile grid icon-share",attrs:{"icon-class":"share"}}):e._e()],1)]):e._e(),e._v(" "),e.item.ossFolder&&!e.public?t("div",[e.pc?t("div",[e.grid?e._e():t("el-tag",{staticClass:"pc list oss-folder",attrs:{size:"small"}},[e._v(e._s(e.item.ossPlatform))]),e._v(" "),e.grid?t("el-tag",{staticClass:"pc grid oss-folder",attrs:{size:"small"}},[e._v(e._s(e.item.ossPlatform))]):e._e()],1):t("div",[e.grid?e._e():t("el-tag",{staticClass:"mobile list oss-folder",attrs:{size:"small"}},[e._v(e._s(e.item.ossPlatform))]),e._v(" "),e.grid?t("el-tag",{staticClass:"mobile grid oss-folder",attrs:{size:"small"}},[e._v(e._s(e.item.ossPlatform))]):e._e()],1)]):e._e(),e._v(" "),e.item.isFolder?t("svg-icon",{attrs:{"icon-class":"folder"}}):e.item.contentType.indexOf("video")>-1?t("div",[void 0===e.item.mediaCover||"true"===e.item.mediaCover?t("div",[e.grid&&e.pc?t("div",{staticClass:"grid-play-icon"},[t("svg-icon",{attrs:{"icon-class":"play1"}})],1):e._e(),e._v(" "),e.grid?t("el-image",{style:{height:e.details?"110px":e.gridWidth-35+"px"},attrs:{lazy:"",fit:"contain",src:e.item.fileId?e.audioCoverUrl+e.item.fileId:e.audioCoverUrl+e.item.id}},[t("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[t("svg-icon",{attrs:{"icon-class":"video"}})],1)]):e._e(),e._v(" "),e.grid?e._e():t("el-avatar",{attrs:{shape:"square",fit:"contain",src:e.item.fileId?e.audioCoverUrl+e.item.fileId:e.audioCoverUrl+e.item.id}},[t("div",{attrs:{slot:"default"},slot:"default"},[t("svg-icon",{staticClass:"avatar-default-image",attrs:{"icon-class":"video"}})],1)])],1):t("svg-icon",{attrs:{"icon-class":"video"}})],1):e.item.contentType.indexOf("audio")>-1?t("div",[void 0!==e.item.music?t("div",[null!==e.item.music.name?t("div",[e.grid?t("el-image",{style:{height:e.details?"110px":e.gridWidth-35+"px"},attrs:{fit:"contain",src:e.item.fileId?e.audioCoverUrl+e.item.fileId:e.audioCoverUrl+e.item.id}},[t("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[t("svg-icon",{attrs:{"icon-class":"audio"}})],1)]):e._e(),e._v(" "),e.grid?e._e():t("el-avatar",{attrs:{shape:"square",src:e.item.fileId?e.audioCoverUrl+e.item.fileId:e.audioCoverUrl+e.item.id}},[t("div",{attrs:{slot:"default"},slot:"default"},[t("svg-icon",{staticClass:"avatar-default-image",attrs:{"icon-class":"audio"}})],1)])],1):e._e()]):t("svg-icon",{attrs:{"icon-class":"audio"}})],1):e.item.contentType.startsWith("image")?t("div",[e.grid||"details"===e.grid?t("el-image",{style:{height:e.details?"110px":e.gridWidth-35+"px"},attrs:{fit:"contain",src:e.item.fileId?e.imageUrl+e.item.fileId:e.imageUrl+e.item.id}},[t("div",{staticClass:"image-slot",attrs:{slot:"error"},slot:"error"},[t("svg-icon",{attrs:{"icon-class":"image"}})],1)]):e._e(),e._v(" "),e.grid?e._e():t("el-avatar",{attrs:{shape:"square",src:e.item.fileId?e.imageUrl+e.item.fileId:e.imageUrl+e.item.id}})],1):t("svg-icon",{attrs:{"icon-class":e.findIconClass}})],1)},a=[],s=(i("c5f6"),i("1000")),o={name:"IconFile",props:{imageUrl:{type:String,default:""},audioCoverUrl:{type:String,default:""},grid:{type:Boolean,default:!1},gridWidth:{type:Number,default:120},details:{type:Boolean,default:!1},public:{type:Boolean,default:!1},item:{type:Object,default:function(){return{}}}},data:function(){return{pc:window.pc}},mounted:function(){},computed:{findIconClass:function(){var e=this.item.suffix;return!e&&this.item.fileName&&(e=this.item.fileName.substring(this.item.fileName.lastIndexOf(".")+1)),s["a"].has(e)?s["a"].get(e):"file"}},methods:{}},r=o,l=(i("51c9"),i("2877")),c=Object(l["a"])(r,n,a,!1,null,"c38d91de",null);t["a"]=c.exports},"105b":function(e,t,i){"use strict";i("657f")},1638:function(e,t,i){"use strict";var n=function(){var e=this,t=e._self._c;return t("div",[t("viewer",{directives:[{name:"show",rawName:"v-show",value:e.pc,expression:"pc"}],ref:"viewer",staticClass:"viewer",attrs:{options:e.options,images:e.images},on:{inited:e.inited},scopedSlots:e._u([{key:"default",fn:function(i){return e._l(i.images,(function(e,i){return t("div",{key:i},[t("img",{attrs:{src:e.thumbnail,"data-src":e.source}})])}))}}])})],1)},a=[],s=(i("7f7f"),i("ac6a"),i("f559"),i("2690")),o=i("9dce"),r={name:"ImageViewer",components:{},props:{file:{type:Object,default:function(){return{}}},shareId:{type:String,default:void 0},fileList:{type:Array,default:function(){return[]}},status:{type:Boolean,default:function(){return!1}}},computed:{},data:function(){return{imageThumbnailUrl:"".concat("/api","/view/thumbnail"),shareImageThumbnailUrl:"".concat("/api","/public/s/view/thumbnail"),publicImageThumbnailUrl:"/api/public/s/view/thumbnail",currentSrc:"",images:[],imagesFristIndex:-1,imagesLastIndex:-1,imageFiles:[],vantImagePreview:null,pc:this.$pc,options:{url:"data-src",initialViewIndex:3,ready:function(e){},show:function(e){},shown:function(e){},hide:function(e){},hidden:function(){o["a"].$emit("updateImageViewerStatus",!1)},view:function(e){},viewed:function(e){},zoom:function(e){},zoomed:function(e){}}}},watch:{status:function(e){var t=this;if(this.pc=this.$pc,e){this.images=[];var i=0;this.imageFiles=this.fileList.filter((function(e){return!e.isFolder&&e.contentType.startsWith("image")})),this.imageFiles.forEach((function(e){t.images.push({thumbnail:t.getImageUrlByThumbnail(e),source:t.getImageUrl(e)}),t.file.id===e.id&&(i=t.images.length-1)})),this.show(i)}}},mounted:function(){var e=this;o["a"].$on("updateImageViewerStatus",(function(){e.imagesFristIndex=-1,e.imagesLastIndex=-1,e.$emit("update:status",!1)}))},methods:{inited:function(e){this.$viewer=e},getImageUrl:function(e){var t=s["a"].previewUrl(this.$store.state.user.name,e,this.$store.getters.token);return this.shareId&&(t=s["a"].publicPreviewUrl(e,window.shareId,this.$store.getters.shareToken)),t},getImageUrlByThumbnail:function(e){return this.$store.getters.token?"".concat(this.imageThumbnailUrl,"/").concat(e.name,"?jmal-token=").concat(this.$store.state.user.token,"&name=").concat(this.$store.state.user.name,"&id=").concat(e.id):this.$store.getters.shareToken?"".concat(this.shareImageThumbnailUrl,"/").concat(e.name,"?share-token=").concat(this.$store.getters.shareToken,"&id=").concat(e.id):"".concat(this.publicImageThumbnailUrl,"/").concat(e.name,"?id=").concat(e.id)},show:function(e){var t=0;e&&(t=e),this.$pc?(this.$viewer.index=t,this.$viewer.show()):this.imagePreview(t)},imagePreview:function(e){var t=[];this.images.forEach((function(e){t.push(e.source)})),this.vantImagePreview=vant.ImagePreview({images:t,startPosition:e,onClose:function(){o["a"].$emit("updateImageViewerStatus",!1)}})}}},l=r,c=(i("105b"),i("2877")),d=Object(c["a"])(l,n,a,!1,null,"5e06ffb4",null);t["a"]=d.exports},"2be3":function(e,t,i){"use strict";i("a8ce")},"2cd5":function(e,t,i){"use strict";i("5f90")},"2d53":function(e,t,i){"use strict";i("aef6"),i("7f7f");var n=function(){var e=this,t=e._self._c;return t("div",[t("message-dialog",{attrs:{title:"确认信息",content:"检测到未保存的内容，是否在离开前保存修改？",show:e.isSaveDialogVisible,operatButtonText:"放弃修改",confirmButtonText:"保存"},on:{"update:show":function(t){e.isSaveDialogVisible=t},operating:e.closeDialog,confirm:e.confirmUpdate}}),e._v(" "),t("message-dialog",{attrs:{title:"确认信息",content:"是否在关闭前保存修改？",show:e.isTabSaveDialogVisible,operatButtonText:"放弃修改",confirmButtonText:"保存"},on:{"update:show":function(t){e.isTabSaveDialogVisible=t},operating:e.closeTabDialog,confirm:e.saveTabAndClose}}),e._v(" "),t("el-dialog",e._g(e._b({directives:[{name:"resize",rawName:"v-resize",value:e.containerResize,expression:"containerResize"},{name:"dialogDrag",rawName:"v-dialogDrag",value:{dialogWidthPercent:e.dialogWidthPercent},expression:"{ dialogWidthPercent: dialogWidthPercent}"}],ref:"simTextDialog",staticClass:"simtext-dialog",attrs:{fullscreen:e.fullscreen,visible:e.textPreviewVisible,title:e.file.name,"close-on-click-modal":!1,"before-close":e.handleClose,width:e.dialogWidth+"px"},on:{"update:visible":function(t){e.textPreviewVisible=t},close:e.closeDialog}},"el-dialog",e.$attrs,!1),e.$listeners),[t("div",{staticClass:"simtext-header-title",attrs:{slot:"title"},slot:"title"},[t("span",{directives:[{name:"show",rawName:"v-show",value:!e.moblie,expression:"!moblie"}]},[t("file-path-nav",{staticClass:"title-name",attrs:{path:e.filePathNav},on:{loadPath:e.loadPath}})],1),e._v(" "),t("div",{staticClass:"title-extension"},[t("history-popover",{ref:"historyPopover",attrs:{saved:!e.isShowUpdateBtn,"has-history-version":e.hasHistoryVersion,"history-list-popover-visible":e.historyListPopoverVisible,"history-operation-loading":!e.loading.closed,"light-theme":e.lightTheme,buttonSize:"small"},on:{"update:hasHistoryVersion":function(t){e.hasHistoryVersion=t},"update:has-history-version":function(t){e.hasHistoryVersion=t},"update:historyListPopoverVisible":function(t){e.historyListPopoverVisible=t},"update:history-list-popover-visible":function(t){e.historyListPopoverVisible=t},"update:lightTheme":function(t){e.lightTheme=t},"update:light-theme":function(t){e.lightTheme=t},viewHistoryFile:e.viewHistoryFile,recoverySuccess:e.recoverySuccess,loadHistoryPathListSuccess:e.loadHistoryPathListSuccess}}),e._v(" "),e.isShowUpdateBtn?t("el-button",{class:e.lightTheme?"":"dark-button",attrs:{size:"small",loading:e.updating},on:{click:function(t){return e.saveAll(!1)}}},[e._v("保存所有")]):e._e(),e._v(" "),t("el-button",{class:e.lightTheme?"":"dark-button",attrs:{size:"small",icon:e.lightTheme?"el-icon-moon":"el-icon-sunny",circle:"",title:e.lightTheme?"暗色":"亮色"},on:{click:e.skinning}}),e._v(" "),t("button",{staticClass:"title-extension-button",on:{click:e.fullScreen}},[t("svg-icon",{attrs:{"icon-class":e.fullscreen?"normalscreen":"fullscreen"}})],1),e._v(" "),t("button",{staticClass:"title-extension-button",on:{click:e.closeDialog}},[t("i",{staticClass:"el-dialog__close el-icon el-icon-close"})])],1)]),e._v(" "),t("div",{staticClass:"content",style:{height:e.editorHieght+26+"px"}},[t("div",{staticClass:"file-contents",style:{width:e.contentsWidth+"px",height:e.editorHieght+32+"px",transition:e.transition,left:e.panelReadOnly||e.moblie?"-".concat(e.contentsWidth,"px"):"0px"}},[t("div",{staticClass:"content-tree"},[this.shareId?e._e():t("fancy-tree",{ref:"fancTree",attrs:{editableTabs:e.editableTabs,editableTabsValue:e.editableTabsValue,contentsWidth:e.contentsWidth,contentsHieght:e.editorHieght,lightTheme:e.lightTheme,directoryTreeData:e.directoryTreeData},on:{"update:editableTabsValue":function(t){e.editableTabsValue=t},"update:editable-tabs-value":function(t){e.editableTabsValue=t},treeNodeClick:e.treeNodeClick,onLoadTreePath:e.onLoadTreePath,onRename:e.onRename,removeFile:e.removeFile}})],1)]),e._v(" "),t("div",{staticClass:"editor-resize",style:{marginLeft:e.panelReadOnly||e.moblie?"0px":"".concat(e.contentsWidth,"px"),transition:e.transition}},[t("div",{staticClass:"darg-resize-conter"}),e._v(" "),t("i",{directives:[{name:"show",rawName:"v-show",value:!e.panelReadOnly&&!e.moblie,expression:"!panelReadOnly && !moblie "}],staticClass:"editor-resize-conter",attrs:{icon:"el-icon-arrow-right",title:"隐藏文件目录"},on:{click:e.hideContents}})]),e._v(" "),t("div",{style:{width:e.editorWidth-2+"px"}},[t("el-tabs",{attrs:{type:"card",closable:""},on:{"tab-remove":e.removeTab,"tab-click":e.clickTab},model:{value:e.editableTabsValue,callback:function(t){e.editableTabsValue=t},expression:"editableTabsValue"}},e._l(e.editableTabs,(function(i,n){return t("el-tab-pane",{key:i.name,attrs:{label:i.title,name:i.name}},[t("span",{attrs:{slot:"label"},slot:"label"},[t("svg-icon",{staticClass:"tabs-icon-svg",attrs:{"icon-class":e.findSvgClass(i.name)}}),e._v(" "+e._s(i.title))],1),e._v(" "),e.textPreviewVisible?t("div",{staticClass:"editor"},[t("vditor-preview",{directives:[{name:"show",rawName:"v-show",value:e.editableTabsValue.endsWith(".md")&&e.previewMode,expression:"editableTabsValue.endsWith('.md') && previewMode"}],ref:"vditor"+n,refInFor:!0,staticClass:"content-body",style:{height:e.editorHieght+"px"}}),e._v(" "),t("MonacoEditor",{directives:[{name:"show",rawName:"v-show",value:!e.editableTabsValue.endsWith(".md")||!e.previewMode,expression:"editableTabsValue.endsWith('.md') ? !previewMode: true"}],ref:"monacoEditor"+n,refInFor:!0,attrs:{width:e.editorWidth,height:e.editorHieght,theme:e.lightTheme?"vs":"vs-dark",language:i.language,diffEditor:i.hasHistoryVersion,original:"...",options:e.options},on:{change:function(t){return e.change(t,n)},save:function(t){return e.save(t,n)}}})],1):e._e()])})),1)],1)]),e._v(" "),t("div",{staticClass:"nwse-resize",style:{left:e.dialogWidth-15+"px"}})])],1)},a=[],s=i("7641"),o=i("a8f9"),r=(i("28a5"),i("6b54"),i("1a0e")),l=(i("96cf"),i("97bf")),c=(i("20d6"),i("6762"),i("2fdb"),i("ac6a"),i("5df3"),i("f400"),i("2ef0")),d=i.n(c),u=(i("3b6a"),i("5cfc")),h=i("9189"),f=i("021e"),m=i("1000"),p=i("6f8e"),v=(i("f559"),i("c5f6"),i("33f9"));function g(){}var y={name:"MonacoEditor",props:{diffEditor:{type:Boolean,default:!1},width:Number,height:Number,original:String,value:String,language:{type:String,default:"javascript"},theme:{type:String,default:"vs"},options:{type:Object,default:function(){return{}}},editorMounted:{type:Function,default:g},editorBeforeMount:{type:Function,default:g}},watch:{options:{deep:!0,handler:function(e){this.editor&&this.editor.updateOptions(e)}},value:function(){this.editor&&this.value!==this._getValue()&&this._setValue(this.value),this.editor.setScrollPosition({scrollTop:0,scrollLeft:0})},language:function(){if(this.editor)if(this.diffEditor){var e=this.editor.getModel(),t=e.original,i=e.modified;v["editor"].setModelLanguage(t,this.language),v["editor"].setModelLanguage(i,this.language)}else v["editor"].setModelLanguage(this.editor.getModel(),this.language)},theme:function(){this.editor&&v["editor"].setTheme(this.theme)},style:function(){var e=this;this.editor&&this.$nextTick((function(){e.editor.layout()}))}},computed:{style:function(){return{width:"".concat(this.width,"px"),height:"".concat(this.height,"px")}}},mounted:function(){this.initMonaco()},beforeDestroy:function(){this.editor&&this.editor.dispose()},render:function(e){var t=this;return e("div",{class:"monaco_editor_container",style:this.style,on:{keydown:function(e){var i=navigator.platform.startsWith("Mac"),n=e.key,a=e.code,s=e.keyCode,o=e.ctrlKey,r=e.metaKey,l=i&&r||!i&&o;if(l){var c="s"===n||"KeyS"===a||83===s;c&&(t.$emit("save",t._getValue()),e.stopPropagation(),e.preventDefault())}}}})},methods:{keyDown:function(e){var t=navigator.platform.startsWith("Mac"),i=e.key,n=e.code,a=e.keyCode,s=e.ctrlKey,o=e.metaKey,r=t&&o||!t&&s;if(r){var l="s"===i||"KeyS"===n||83===a;l&&(this.$emit("save",this._getValue()),e.stopPropagation(),e.preventDefault())}},initMonaco:function(){var e=this.value,t=this.language,i=this.theme,n=this.options;Object.assign(n,this._editorBeforeMount()),this.editor=v["editor"][this.diffEditor?"createDiffEditor":"create"](this.$el,Object(p["a"])({value:e,language:t,theme:i},n)),this.diffEditor&&this._setModel(this.value,this.original),this._editorMounted(this.editor)},onKeyDown:function(e){var t=navigator.platform.startsWith("Mac"),i=e.key,n=e.code,a=e.keyCode,s=e.ctrlKey,o=e.metaKey,r=t&&o||!t&&s;if(r){var l="s"===i||"KeyS"===n||83===a;l&&this.textPreviewVisible&&(""!==this.newContent&&this.save(),e.stopPropagation(),e.preventDefault())}},_getEditor:function(){return this.editor?this.diffEditor?this.editor.modifiedEditor:this.editor:null},_setModel:function(e,t){var i=this.language,n=v["editor"].createModel(t,i),a=v["editor"].createModel(e,i);this.editor.setModel({original:n,modified:a})},_setValue:function(e){var t=this._getEditor();if(t)return t.setValue(e)},_getValue:function(){var e=this._getEditor();return e?e.getValue():this.diffEditor?this.editor.getModel().modified.getValue():""},_editorBeforeMount:function(){var e=this.editorBeforeMount(v);return e||{}},_editorMounted:function(e){var t=this;this.editorMounted(e,v),this.diffEditor?e.onDidUpdateDiff((function(e){var i=t._getValue();t._emitChange(i,e)})):e.onDidChangeModelContent((function(e){var i=t._getValue();t._emitChange(i,e)}))},_emitChange:function(e){this.$emit("change",e),this.$emit("input",e)}}},b=i("9476"),w=function(){var e=this,t=e._self._c;return t("div",[t("v-contextmenu",{ref:"clickContextmenu",attrs:{theme:e.lightTheme?"default":"dark","event-type":"click"}},e._l(e.menus,(function(i){return t("v-contextmenu-item",{key:i.operation,on:{click:function(t){return e.contextmenuClick(i.operation)}}},[t("svg-icon",{attrs:{"icon-class":i.iconClass}}),e._v("\n      "+e._s(i.label)+"\n    ")],1)})),1),e._v(" "),t("v-contextmenu",{ref:"contextmenu",attrs:{theme:e.lightTheme?"default":"dark"},on:{contextmenu:e.contextmenu}},e._l(e.menus,(function(i){return t("v-contextmenu-item",{key:i.operation,on:{click:function(t){return e.contextmenuClick(i.operation)}}},[t("svg-icon",{attrs:{"icon-class":i.iconClass}}),e._v("\n      "+e._s(i.label)+"\n    ")],1)})),1),e._v(" "),t("div",{staticClass:"dir-tools",staticStyle:{"min-width":"272px"}},[t("el-button-group",[t("el-button",{class:e.lightTheme?"light-button":"dark-button",attrs:{size:"small",icon:"el-icon-arrow-left",disabled:0===this.currentPath.length||"/"===this.currentPath},on:{click:e.upperLeve}},[e._v("上一级")]),e._v(" "),t("el-button",{class:e.lightTheme?"light-button":"dark-button",attrs:{size:"small",icon:"el-icon-refresh"},on:{click:e.refresh}},[e._v("刷新")]),e._v(" "),t("el-button",{directives:[{name:"contextmenu",rawName:"v-contextmenu:clickContextmenu",arg:"clickContextmenu"}],class:e.lightTheme?"light-button":"dark-button",attrs:{size:"small",icon:"el-icon-plus"},on:{click:e.newFileAndFolder}},[e._v("新建")]),e._v(" "),t("el-popover",{attrs:{placement:"bottom",width:"250",trigger:"click"}},[t("el-input",{attrs:{placeholder:"请输入内容",size:"small"}},[t("el-button",{attrs:{slot:"append",size:"small",icon:"el-icon-search"},slot:"append"})],1)],1)],1)],1),e._v(" "),t("div",{style:{width:e.contentsWidth+"px",height:e.contentsHieght+"px"},attrs:{id:"dir-tree"}})],1)},x=[],T=(i("a481"),i("231f"),i("e8a0"),i("f020")),C=i.n(T),_=i("9dce"),k={name:"FancyTree",props:{contentsWidth:{type:Number,default:250},contentsHieght:{type:Number,default:500},directoryTreeData:{type:Object,default:function(){}},lightTheme:{type:Boolean,default:!0},editableTabs:{type:Array,default:function(){return[]}},editableTabsValue:{type:String,defalut:"1"}},data:function(){return{tree:{},currentPath:"/",contextData:{},rightClicking:!1,menus:[],folderMenus:[{iconClass:"open-folder",label:"进入该目录",operation:"openFolder"},{iconClass:"menu-remove",label:"删除",operation:"remove"}],fileMenus:[{iconClass:"menu-rename",label:"重命名",operation:"rename"},{iconClass:"menu-remove",label:"删除",operation:"remove"}],fileMenus1:[{iconClass:"menu-addtab",label:"在新的标签打开",operation:"openFileOfNewTab"},{iconClass:"menu-rename",label:"重命名",operation:"rename"},{iconClass:"menu-remove",label:"删除",operation:"remove"}],newFileMenus:[{iconClass:"add-file",label:"新建文件",operation:"addFile"},{iconClass:"folder-add",label:"新建目录",operation:"addFolder"}]}},mounted:function(){this.loadTreeData(this.directoryTreeData)},watch:{directoryTreeData:function(e){this.directoryTreeData=e,this.loadTreeData(this.directoryTreeData,!0)}},computed:{},methods:{initTree:function(e){var t=this,i=this;this.tree=C.a.createTree("#dir-tree",{extensions:["edit"],icon:function(e,i){return t.icon(e,i)},source:this.convert(e),lazyLoad:function(e,i){return t.lazyLoad(e,i)},click:function(e,i){return t.click(e,i)},dblclick:function(e,i){return t.dblclick(e,i)},activate:function(e,i){return t.activate(e,i)},createNode:function(e,i){return t.createNode(e,i)},edit:{triggerStart:["f2","mac+enter"],beforeEdit:function(e,t){var n=i.editableTabs.some((function(e){return t.node.data.path===e.name&&"Modifying"===e.status}));return n&&i.$message.warning("不能对正在修改的文件重命名"),!n},edit:function(e,t){var i=t.node.span.querySelector(".fancytree-title .fancytree-edit-input"),n=i.style.width.substring(0,i.style.width.length-2);i.style.width=parseInt(n)+50+"px",i.value&&i.value.length-1>t.node.data.suffix.length&&(i.selectionStart=0,i.selectionEnd=i.value.length-1-t.node.data.suffix.length)},beforeClose:function(e,t){return"mousedown"===t.originalEvent.type?(t.originalEvent.preventDefault(),!1):!t.node.data.path||i.nameValid(t.input.val(),t.node.data,t.node)},save:function(e,t){return t.node.data.path?i.nodeRename(t.input.val(),t.node.data,t.node):i.createFile(t.input.val(),t.node.data,t.node),!0},close:function(e,t){return t.node&&i.addRef(t.node),!1}}})},addRef:function(e){this.$refs.contextmenu.addRef({el:e.span,vnode:e.span})},contextmenu:function(e){var t=this;this.rightClicking=!0;var i=this;setTimeout((function(){i.rightClicking=!1}),200),this.contextData=C.a.getNode(e).data;var n=document.createEvent("MouseEvents");if(n.initMouseEvent("click",!0,!0,window,1,12,345,7,220,!1,!1,!0,!1,0,null),e.dispatchEvent(n),this.contextData.isFolder)this.menus=this.folderMenus;else if(void 0===this.contextData.isFolder);else{this.menus=this.fileMenus;var a=this.editableTabs.some((function(e){return e.name===t.contextData.path}));!a&&m["c"].simText.includes(this.contextData.suffix)&&(this.menus=this.fileMenus1)}},contextmenuClick:function(e){var t=this.tree.getActiveNode();switch(e){case"openFolder":this.enterDir(this.contextData);break;case"remove":this.delFile(this.contextData);break;case"rename":this.tree.getActiveNode().editStart();break;case"addFile":this.editCreateNode(t,!1);break;case"addFolder":this.editCreateNode(t,!0);break;case"openFileOfNewTab":this.contextData.isAddTab=!0,this.$emit("treeNodeClick",this.contextData);break;default:break}},editCreateNode:function(e,t){null!==e&&void 0!==e?e.folder?e.editCreateNode("child",{title:"",folder:t}):e.editCreateNode("after",{title:"",folder:t}):this.tree.getRootNode().editCreateNode("child",{title:"",folder:t})},delFile:function(e){var t=this;this.$confirm("此操作将永久删除"+e.name+"，\n 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){u["a"].delFile({username:t.$store.state.user.name,path:encodeURI(e.path)}).then((function(){t.$emit("removeFile",e.path);var i=t.tree.getActiveNode();i.remove(),t.$message.success("删除成功！")}))}))},upperLeve:function(){var e=this;if(0!==this.currentPath.length){var t=this.currentPath.split("/"),i=t[t.length-2],n=this.currentPath.substring(0,this.currentPath.length-i.length);u["a"].upperLevelList({username:this.$store.state.user.name,path:encodeURI(n)}).then((function(t){e.tree.reload(e.convert(t.data))}))}},refresh:function(){var e=this;u["a"].listfiles({userId:this.$store.state.user.userId,username:this.$store.state.user.name,path:encodeURI(this.currentPath)}).then((function(t){e.tree.reload(e.convert(t.data))}))},newFileAndFolder:function(){this.menus=this.newFileMenus},enterDir:function(e){var t=this,i=this.$message({iconClass:"el-icon-loading",type:"info",duration:0,dangerouslyUseHTMLString:!0,offset:document.body.clientHeight/3,message:"<span>&nbsp;&nbsp;正在加载数据...</span>"});u["a"].listfiles({userId:this.$store.state.user.userId,username:this.$store.state.user.name,path:encodeURI(e.path)}).then((function(n){i.close(),0===n.data.length&&(t.currentPath=e.path+"/"),t.tree.reload(t.convert(n.data))})).catch((function(){i.close()}))},loadPath:function(e){e.name=e.title,this.loadTreeData(e,!0)},loadTreeData:function(e,t,i){var n=this;u["a"].listfiles({userId:this.$store.state.user.userId,username:this.$store.state.user.name,path:encodeURI(e.path)}).then((function(a){var s=e.name,o=a.data.map((function(e){return s===e.name&&(e.active=!0),e.key=e.path,e.title=e.name,e.folder=e.isFolder,e.lazy=e.isFolder,e}));t?n.$nextTick((function(){n.tree.reload(n.convert(o)),i&&n.$emit("treeNodeClick",i)})):n.initTree(n.convert(o))}))},createFile:function(e,t,i){var n=this,a="/";if(i.parent.folder)a=i.parent.data.path;else{var s=i.parent.children[0].data;s.path?a+=s.path.substring(0,s.path.length-s.name.length):a+=this.currentPath}u["a"].addFile({fileName:encodeURI(e),isFolder:i.folder,username:this.$store.state.user.name,parentPath:encodeURI(a)}).then((function(e){var t=i.folder?"文件夹":"文件";n.$message.success("新建".concat(t,"成功"));var a=e.data,s="/"+a.path.substring(0,a.path.length-a.name.length);n.loadTreeData({name:a.name,path:s},!0,a)})).catch((function(){i.remove()}))},nameValid:function(e,t,i){if(e){if(e===t.name)return!0;if(/[\[\]\/\\"<>\?\*]/gi.test(e))return this.$message({message:"文件名不能包含以下字符:<,>,|,*,?,,/,[,]",type:"warning"}),!1;var n=i.parent.children.findIndex((function(t){return e===t.data.name}));if(n>-1){var a="该文件已存在";return t.isFolder&&(a="该文件夹已存在"),this.$message({message:a,type:"warning"}),!1}return!0}return!1},nodeRename:function(e,t,i){var n=this;if(e){var a=e.replace(/.+\./,""),s=e.substring(0,e.length-a.length);return t.isFolder?this.rename(t,e,i):t.suffix!==a?this.$confirm("您确定要将扩展名“.".concat(t.suffix,"”更改为“.").concat(a,"”吗？"),"提示",{type:"warning",showClose:!1,closeOnClickModal:!1,confirmButtonText:"保持.".concat(t.suffix),cancelButtonText:"使用.".concat(a)}).then((function(){e=s+"."+t.suffix})).catch((function(){})).then((function(){n.rename(t,e,i)})):this.rename(t,e,i),!0}},rename:function(e,t,i){var n=this;e.name!==t?u["a"].renameByPath({newFileName:t,username:this.$store.state.user.name,path:encodeURI(i.data.path)}).then((function(a){a.data&&(e.oldName=i.data.name,e.name=t,e.suffix=t.replace(/.+\./,""),_["a"].$emit("renameRow",e),e.oldPath=e.path,e.path=e.path.substring(0,e.path.length-e.oldName.length)+t,i.setTitle(t),n.addRef(i),n.$message.success("修改成功！"),n.$emit("onRename",e),n.editableTabsValue===e.oldPath&&n.$emit("update:editableTabsValue",e.path))})):i.setTitle(t)},icon:function(e,t){return{html:this.loadSvg(this.findIconClass(t.node.data))}},findIconClass:function(e){if(e){if(e.isFolder)return"folder";if(e.contentType){if(e.contentType.indexOf("video")>-1)return"video";if(e.contentType.startsWith("image"))return"image";if(e.contentType.indexOf("audio")>-1)return"audio"}var t=e.suffix;return!t&&e.name&&(t=e.name.substring(e.name.lastIndexOf(".")+1)),m["a"].has(t)?m["a"].get(t):"file"}},loadSvg:function(e){if(e){var t=i("5d88")("./".concat(e,".svg"));return'<svg class="tree-icon">'.concat(t.default.render(),'<use xlink:href="#icon-').concat(e,'"/></svg>')}},lazyLoad:function(e,t){var i=t.node.data;t.result=this.lazyLoadData(i)},lazyLoadData:function(e){var t=this;return new Promise((function(i){u["a"].listfiles({username:t.$store.state.user.name,path:encodeURI(e.path)}).then((function(e){i(t.convert(e.data))}))}))},click:function(e,t){this.rightClicking||this.$emit("treeNodeClick",t.node.data)},dblclick:function(e,t){},activate:function(e,t){},createNode:function(e,t){"nodata"!==t.node.statusNodeType?this.addRef(t.node):t.node.span.querySelector(".fancytree-title").innerText="无数据"},convert:function(e){return e&&e.length>0&&(this.currentPath=e[0].path.substring(0,e[0].path.length-e[0].name.length)),0===this.currentPath.length&&(this.currentPath="/"),this.$emit("onLoadTreePath",this.currentPath),e.map((function(e){return e.key=e.path,e.title=e.name,e.folder=e.isFolder,e.lazy=e.isFolder,e}))}}},S=k,L=(i("fea7"),i("2877")),$=Object(L["a"])(S,w,x,!1,null,"49856f58",null),P=$.exports,I=i("5a87"),V=function(){var e=this,t=e._self._c;return t("el-breadcrumb",{staticClass:"app-breadcrumb",attrs:{separator:""}},[t("transition-group",{attrs:{name:"breadcrumb"}},e._l(e.pathList,(function(i,n){return t("el-breadcrumb-item",{key:i.path},[0===n?t("a",{staticClass:"home-link",on:{click:function(t){return t.preventDefault(),e.handleLink(i,n)}}},[t("svg-icon",{staticStyle:{"font-size":"18px"},attrs:{"icon-class":"home"}})],1):e._e(),e._v(" "),t("breadcrumb-file-path",{attrs:{pathList:e.pathList,item:i,index:n},on:{clickLink:e.handleLink}})],1)})),1)],1)},D=[],E=i("7f29"),O=i("573f"),M={name:"FilePathNav",components:{BreadcrumbFilePath:O["a"]},props:{path:{type:String,default:""}},data:function(){return{pathList:[]}},watch:{path:function(e){var t=this;this.pathList=[{folder:"",path:"/"}];var i=e.split("/").filter((function(e){return e.length>0}));i.forEach((function(e,n){var a={folder:e,path:t.getPath(i,n)};t.pathList.push(a)}))}},created:function(){},methods:{strLength:function(e){return Object(E["d"])(e)},substring10:function(e){return Object(E["f"])(e)},substring:function(e,t){return Object(E["e"])(e,t)},getPath:function(e,t){var i="/";if(e&&e.length>t)for(var n=0;n<=t;n++)i+=e[n]+"/";return i},handleLink:function(e){this.$emit("loadPath",e)}}},F=M,N=(i("a51a"),Object(L["a"])(F,V,D,!1,null,"c1933122",null)),U=N.exports,H=i("00a1"),B=function(){var e=this,t=e._self._c;return t("div",[t("div",{style:{height:e.height},attrs:{id:"vditor"}})])},W=[],R=i("6e08"),z=i.n(R),j=(i("ae60"),{name:"VidtorPreview",components:{},props:{height:{type:String,default:null},content:{type:String,default:""}},computed:{},data:function(){return{vditorPreviewShow:!1}},watch:{content:function(e){this.setContent(e)}},mounted:function(){this.content&&(this.vditorPreviewInit(this.content),this.vditorPreviewShow=!0)},methods:{setContent:function(e){this.vditorPreviewShow||(this.vditorPreviewInit(e),this.vditorPreviewShow=!0)},vditorPreviewInit:function(e){var t=this;z.a.preview(document.getElementById("vditor"),e,{speech:{enable:!0},hljs:{lineNumber:!0},after:function(){t.$emit("after")}})}}}),A=j,q=Object(L["a"])(A,B,W,!1,null,null,null),K=q.exports,J=i("2edc"),X={name:"SimTextPreview",components:{HistoryPopover:J["a"],Icon:H["a"],MonacoEditor:y,FileTree:b["a"],FancyTree:P,MessageDialog:I["a"],FilePathNav:U,VditorPreview:K},props:{file:{type:Object,default:function(){return{}}},shareId:{type:String,default:void 0},filepath:{type:String,default:void 0},status:{type:Boolean,default:function(){return!1}}},computed:{},data:function(){return{lightTheme:!0,contentsHide:!1,defalutLanguage:"redis",lineWrapping:!1,moblie:!1,panelReadOnly:!0,options:{fontSize:14,contextmenu:!0,codeLens:!0,readOnly:!0,lineNumbers:this.$pc,minimap:{enabled:this.$pc},wordWrap:this.lineWrapping?"wordWrapColumn":"",wordWrapMinified:!0,wrappingIndent:"indent",preview:!0,previewMode:"subwordSmart"},textPreviewVisible:!1,fullscreen:!1,dialogWidth:650,minDialogWidth:650,dialogWidthPercent:.7,lastTransform:void 0,contentsWidth:273,editorWidth:1035,editorHieght:640,transition:"all 500ms ease 0s",newContent:"",previewMode:!0,isShowUpdateBtn:!1,updating:!1,modifyMsg:void 0,isSaveDialogVisible:!1,isTabSaveDialogVisible:!1,removeIndex:0,loading:{},darkButton:{background:"#3e3e3e!important",border:"1px solid #3e3e3e!important",color:"#ffffff!important"},directoryTreeData:{},editableTabsValue:"1",nextActiveName:"",editableTabs:[],editableValueMap:new Map,abortControllerMap:new Map,editableVersionMap:new Map,hasHistoryVersion:!1,historyListPopoverVisible:!1,historyVersion:{metadata:{}},filePathNav:"",toolbars:{readmodel:!0,navigation:!0}}},mounted:function(){var e=this;this.$nextTick((function(){e.setDialogWidth()}))},directives:{resize:{bind:function(e,t){var i="",n="";function a(){var a=document.defaultView.getComputedStyle(e);i===a.width&&n===a.height||t.value(),i=a.width,n=a.height}e.__vueSetInterval__=setInterval(a,0)},unbind:function(e){clearInterval(e.__vueSetInterval__)}}},watch:{file:function(e){var t=this;if(e.path){this.editableTabs=[],this.checkMobile(),this.checkReadOnly(e.userId),this.loadEditorSize(),this.loading=this.$message({iconClass:"el-icon-loading",type:"info",duration:0,dangerouslyUseHTMLString:!0,offset:100,message:"<span>&nbsp;&nbsp;正在加载数据...</span>"}),m["b"].includes(e.suffix)?(this.options.wordWrap="wordWrapColumn",this.lineWrapping=!0):this.options.wordWrap="";var i="previewText";this.shareId&&(i="sharePreviewText"),this.filepath&&(i="previewTextByPath",e.path=this.filepath),e.id||(i="previewTextByPath");var n={shareId:this.shareId,fileId:e.id,id:e.id,fileName:e.name,path:encodeURI(e.path),username:this.$store.state.user.name};u["a"][i](n).then((function(e){t.loading.close(),t.directoryTreeData={name:e.data.name,isFolder:!0,isLeaf:!1,id:e.data.id,path:e.data.path},t.textPreviewVisible=!0;var a=e.data.path.substring(1,e.data.path.length)+e.data.name;"previewTextByPath"===i&&(a="/".concat(e.data.path,"/").concat(e.data.name)),t.editableTabs.push({title:e.data.name,copyTitle:e.data.name,language:t.getEditorLanguage(e.data.suffix),status:void 0,name:a}),t.requestStream(i,n,0),t.editableTabsValue=a,t.shareId||t.$refs.historyPopover.loadHistoryPathList(a),t.$nextTick((function(){t.onDialogDblClick(),t.dragDialogSize(),t.dragControllerDiv(),t.setTheme()}))})).catch((function(){t.loading.close()}))}},status:function(e){e&&this.loading.closed&&(this.textPreviewVisible=!0)},editableTabsValue:function(e){if(e.endsWith(".md")&&(this.previewMode=!1),this.hasHistoryVersion=this.editableVersionMap.get(e)||!1,this.hasHistoryVersion){var t=this.editableTabs.findIndex((function(t){return t.name===e})),i=this.editableTabs[t];this.historyVersion=i.historyVersion||{metadata:{}}}else this.historyVersion={metadata:{}}}},methods:{setDialogWidth:function(){this.dialogWidth=document.body.clientWidth*this.dialogWidthPercent},loadHistoryPathListSuccess:function(e){var t=e.res,i=e.pathname;t.count&&t.count>0?this.editableVersionMap.set(i,!0):this.editableVersionMap.set(i,!1),this.hasHistoryVersion=this.editableVersionMap.get(i)},viewHistoryFile:function(e){var t=this,i=e.historyInfo,n=e.diff,a=e.recovery,s=this.editableTabsValue,o=this.editableTabs.findIndex((function(e){return e.name===s})),r=this.editableTabs[o];if(this.isShowUpdateBtn)this.$message({type:"info",message:"请先保存当前修改的内容"});else{var l=this.getContentText(o),c=a?"恢复中...":"加载中...";this.loading=this.$message({iconClass:"el-icon-loading",type:"info",duration:0,dangerouslyUseHTMLString:!0,message:"<span>&nbsp;&nbsp;".concat(c,"</span>")}),h["a"].previewHistoryText({id:i.id}).then((function(e){var c={title:r.title,copyTitle:r.copyTitle,status:void 0,language:r.language,name:s,hasHistoryVersion:!a||n,historyVersion:i};t.removeTab(s),t.$nextTick((function(){t.loading.close(),t.editableTabs.splice(o,0,c),n?t.setEditMap(o,l,e.data.contentText,i.metadata.time):t.setEditMap(o,e.data.contentText),t.editableTabsValue=s,t.historyListPopoverVisible&&(t.historyListPopoverVisible=!1),t.historyVersion=a?{metadata:{}}:c.historyVersion,a&&t.$message({message:"恢复成功",type:"success"})}))})).catch((function(){t.loading.close()}))}},recoverySuccess:function(e){var t=e.historyInfo;this.viewHistoryFile({historyInfo:t,diff:!1,recovery:!0})},abortControllerAbort:function(e){var t=this.abortControllerMap.get(e);void 0!==t&&void 0!==t.abort&&(t.abort.abort(),t.throttle.cancel())},requestStream:function(){var e=Object(l["a"])(Object(r["a"])().mark((function e(t,i,n){var a,s,o,c,u,h,f,m,p,v,g,y=this;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,a=this.panelReadOnly,this.options.readOnly=!0,this.abortControllerAbort(n),s=this.buildQueryString(i),o="/api/preview/text/stream","previewTextByPath"===t?o="/api/preview/path/text/stream":"sharePreviewText"===t&&(o="/api/public/s/preview/text/stream"),c=new AbortController,u=new Headers,this.shareId?u.append("share-token",this.$store.state.user.shareToken):(u.append("jmal-token",this.$store.state.user.token),u.append("name",this.$store.state.user.name)),e.next=12,fetch("".concat(o,"?").concat(s),{signal:c.signal,headers:u});case 12:return h=e.sent,f="",m=d.a.throttle((function(e){y.setEditMap(n,e)}),1500),this.abortControllerMap.set(n,{abort:c,throttle:m}),p=h.body.getReader(),v=new TextDecoder("utf-8"),g=function(){var e=Object(l["a"])(Object(r["a"])().mark((function e(){var t,i,s;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,p.read();case 2:if(t=e.sent,i=t.done,s=t.value,!i){e.next=10;break}return m.cancel(),y.setEditMap(n,f),y.options.readOnly=a,e.abrupt("return");case 10:return f+=v.decode(s,{stream:!0}),m(f),e.next=14,g();case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=21,g();case 21:e.next=26;break;case 23:e.prev=23,e.t0=e["catch"](0),console.error("Fetch error:",e.t0);case 26:case"end":return e.stop()}}),e,this,[[0,23]])})));function t(t,i,n){return e.apply(this,arguments)}return t}(),buildQueryString:function(e){var t=new URLSearchParams;for(var i in e)t.append(i,e[i]);return t.toString()},getEditorLanguage:function(e){var t=this.defalutLanguage,i=v["languages"].getLanguages(),n=i.findIndex((function(t){return t.extensions&&t.extensions.includes("."+e)}));return n>-1&&(t=i[n].id),t},hideContents:function(){var e=this,t=document.querySelector(".file-contents"),i=document.querySelector(".editor-resize");this.contentsHide?(t.style.left="0px",i.style.marginLeft="".concat(this.contentsWidth,"px"),setTimeout((function(){e.editorWidth-=e.contentsWidth}),250),this.contentsHide=!1,i.setAttribute("icon-style","show")):(t.style.left="-".concat(this.contentsWidth,"px"),i.style.marginLeft="0px",setTimeout((function(){e.editorWidth+=e.contentsWidth}),250),this.contentsHide=!0,i.setAttribute("icon-style","hide"))},onDialogDblClick:function(){var e=document.querySelector(".simtext-dialog .el-dialog__header"),t=this;e.ondblclick=function(e){e.target&&"simtext-header-title"===e.target.className&&t.fullScreen()}},dragDialogSize:function(){var e=document.querySelector(".el-dialog__body .nwse-resize");if(e){var t=this;e.onmousedown=function(i){var n=i.clientX,a=i.clientY,s=t.editorWidth,o=t.editorHieght,r=t.dialogWidth;return document.onmousemove=function(e){var i=e.clientX,l=e.clientY,c=i-n;r+c>600&&(t.dialogWidth=r+c,t.editorWidth=s+c,t.editorHieght=o+(l-a),t.loadConterSize())},document.onmouseup=function(){document.onmousemove=null,document.onmouseup=null,e.releaseCapture&&resize.releaseCapture()},e.setCapture&&e.setCapture(),!1}}},dragControllerDiv:function(){var e=document.querySelector(".el-dialog__body .content"),t=document.querySelector(".el-dialog__body .content .editor-resize"),i=document.querySelector(".file-contents"),n=document.querySelector(".file-contents .dir-tools");if(t){var a=this;t.onmousedown=function(s){if(a.contentsHide)return!1;var o=s.clientX,r=i.offsetWidth,l=e.clientWidth,c=.6*l>273?.6*l:600;return document.onmousemove=function(e){a.transition="none 500ms ease 0s";var t=e.clientX,i=t-o;if(r+i>n.style.minWidth.split("px")[0]){var s=r+i;s<c&&(a.contentsWidth=s,a.editorWidth=a.dialogWidth-(r+i))}},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null,t.releaseCapture&&t.releaseCapture(),a.transition="all 500ms ease 0s"},t.setCapture&&t.setCapture(),!1}}},findSvgClass:function(e){var t=e.substring(e.lastIndexOf(".")+1);return m["a"].has(t)?m["a"].get(t):"file"},loadPath:function(e){this.$refs.fancTree.loadPath(e)},onRename:function(e){this.editableTabs.map((function(t){return t.name===e.oldPath&&(t.title=e.name,t.copyTitle=e.name,t.name=e.path),t})),this.editableTabsValue=e.path},onLoadTreePath:function(e){this.filePathNav=e},removeFile:function(e){var t=this.editableTabs.findIndex((function(t){return t.name===e}));t>-1&&this.editableTabs.splice(t,1)},treeNodeClick:function(e){var t=this;if(!e.isFolder&&(m["c"].simText.includes(e.suffix)||!(e.contentType.indexOf("utf-8")<0))){var i=v["languages"].getLanguages(),n=i.findIndex((function(t){return t.extensions&&t.extensions.includes("."+e.suffix)}));if(this.language=n>-1?i[n].id:this.defalutLanguage,m["b"].includes(e.suffix)?(this.options.wordWrap="wordWrapColumn",this.lineWrapping=!0):this.options.wordWrap="",this.editableTabs.findIndex((function(t){return t.name===e.path}))<0){this.loading=this.$message({iconClass:"el-icon-loading",type:"info",duration:0,dangerouslyUseHTMLString:!0,offset:document.body.clientHeight/3,message:"<span>&nbsp;&nbsp;正在加载数据...</span>"});var a={path:encodeURI(e.path),fileName:e.name,username:this.$store.state.user.name};u["a"].previewTextByPath(a).then((function(i){t.loading.close();var n={title:e.name,copyTitle:e.name,status:void 0,language:t.getEditorLanguage(e.suffix),name:e.path};if(e.isAddTab)t.editableTabs.push(n),t.requestStream("previewTextByPath",a,t.editableTabs.length-1);else{var s=t.editableTabs.findIndex((function(e){return void 0===e.status}));s>-1?(t.editableTabs[s]=n,t.requestStream("previewTextByPath",a,s)):(t.editableTabs.push(n),t.requestStream("previewTextByPath",a,t.editableTabs.length-1))}t.editableTabsValue=e.path,t.$refs.historyPopover.loadHistoryPathList(e.path)})).catch((function(){t.loading.close()}))}else this.editableTabsValue=e.path,this.clickTab()}},getContentText:function(e){var t="monacoEditor"+e;return this.$refs[t][0]._getValue()},setEditMap:function(e,t,i,n){var a=this;this.editableValueMap.set(e,t),this.$nextTick((function(){var n="monacoEditor"+e;i?a.$refs[n][0]._setModel(t,i):a.$refs[n][0]._setValue(t),!a.$pc&&a.dialogWidthPercent<1&&a.fullScreen()})),this.$nextTick((function(){var t=a.editableTabs[e].name,i=document.getElementById("pane-".concat(t)),s=i.querySelector(".editor.original"),o=i.querySelector(".editor.modified");null!==s&&null!==o&&(a.setVersionInfo(s,n),a.setVersionInfo(o,"当前版本"))}))},setVersionInfo:function(e,t){var i=e.querySelector(".version-info");if(i)i.textContent=t;else{var n=document.createElement("div");n.className="version-info",n.textContent=t,e.firstChild?e.insertBefore(n,e.firstChild):e.appendChild(n)}},containerResize:function(){this.loadEditorSize()},checkMobile:function(){this.$pc?this.moblie=!1:this.moblie=!0},checkReadOnly:function(e){var t=this;this.$store.state.user.token&&this.$store.state.user.userId===e&&(this.options.readOnly=!1,this.panelReadOnly=!1),this.$pc||(this.options.readOnly=!0,this.panelReadOnly=!1),(this.panelReadOnly||this.moblie)&&this.$nextTick((function(){t.editorWidth+=t.contentsWidth,t.contentsHide=!0}))},loadEditorSize:function(){this.setDialogWidth(),this.contentsHide?this.editorWidth=this.dialogWidth:this.editorWidth=this.dialogWidth-this.contentsWidth,this.editorHieght=document.body.clientHeight*this.dialogWidthPercent-76,this.loadConterSize()},loadConterSize:function(){var e=document.querySelector(".editor-resize .editor-resize-conter");e&&(e.style.marginTop=(this.editorHieght+26)/2-e.clientHeight/2+"px")},handleClose:function(e){this.isShowUpdateBtn?this.isSaveDialogVisible=!0:(e(),this.closeAllTabs())},saveTabAndClose:function(){this.update(this.editableTabs[this.removeIndex].change,this.editableTabs[this.removeIndex].name),this.isTabSaveDialogVisible=!1,this.editableTabs.splice(this.removeIndex,1)},confirmUpdate:function(){this.saveAll(!0),this.textPreviewVisible=!1,this.$emit("update:status",this.textPreviewVisible),this.isSaveDialogVisible=!1,this.isShowUpdateBtn=!1},closeTabDialog:function(){this.isTabSaveDialogVisible=!1,this.editableTabsValue=this.nextActiveName,this.editableTabs.splice(this.removeIndex,1);var e=this.editableTabs.findIndex((function(e){return"Modifying"===e.status}));e<0&&(this.isShowUpdateBtn=!1)},closeDialog:function(){this.textPreviewVisible=!1,this.$emit("update:status",this.textPreviewVisible),this.isSaveDialogVisible=!1,this.isShowUpdateBtn=!1,this.historyVersion={metadata:{}},this.closeAllTabs()},change:function(e,t){var i=this.editableTabs[t];e===this.editableValueMap.get(t)?i.copyTitle!==i.title&&(i.title=i.copyTitle,i.status="Modified",this.editableTabs.findIndex((function(e){return e.title!==e.copyTitle}))<0&&(this.isShowUpdateBtn=!1)):i.copyTitle===i.title&&(i.title+="*",i.status="Modifying",this.isShowUpdateBtn=!0,i.change=e)},saveAll:function(e){var t=this;this.editableTabs.forEach((function(i,n){"Modifying"===i.status&&(e?t.update(i.change,i.name):t.update(i.change,i.name,n))})),e&&this.closeAllTabs()},closeAllTabs:function(){this.editableTabs.splice(0,this.editableTabs.length),this.$emit("update:file",{});var e,t=Object(o["a"])(this.abortControllerMap);try{for(t.s();!(e=t.n()).done;){var i=Object(s["a"])(e.value,2),n=i[0];i[1];this.abortControllerAbort(n)}}catch(a){t.e(a)}finally{t.f()}},save:function(e,t){e!==this.editableTabs[t].content&&this.isShowUpdateBtn&&this.update(e,this.editableTabs[t].name,t)},update:function(e,t,i){var n=this;this.updating=!0,f["a"].editMarkdownByPath({relativePath:encodeURI(t),userId:this.$store.state.user.userId,username:this.$store.state.user.name,contentText:e}).then((function(){if(n.updating=!1,void 0!==i)n.editableTabs[i].content=e,n.editableTabs[i].copyTitle!==n.editableTabs[i].title&&(n.editableTabs[i].title=n.editableTabs[i].copyTitle,n.editableTabs[i].status="Modified",n.editableTabs.findIndex((function(e){return e.title!==e.copyTitle}))<0&&(n.isShowUpdateBtn=!1));else{var t=!1;n.editableTabs.forEach((function(e){"Modifying"===e.status&&(t=!0)})),t||(n.isShowUpdateBtn=!1)}if(!n.modifyMsg){n.$refs.historyPopover.loadHistoryPathList(n.editableTabsValue),n.modifyMsg=n.$message({message:"更新成功",type:"success",duration:1e3});var a=n;setTimeout((function(){a.modifyMsg=void 0}),1e3)}})).catch((function(){n.updating=!1}))},fullScreen:function(){this.fullscreen=!this.fullscreen;var e=document.querySelector(".simtext-dialog .el-dialog");if(this.fullscreen)this.lastTransform=e.style.transform,this.dialogWidthPercent=1,this.setDialogWidth(),e.style.transform="translate(0px,0px)";else{this.dialogWidthPercent=.7,this.setDialogWidth();var t=(document.body.clientWidth-this.dialogWidth)/2,i=(document.body.clientHeight-this.dialogWidth)/2;this.lastTransform?e.style.transform=this.lastTransform:e.style.transform="translate("+t+"px,"+i+"px)"}this.containerResize()},skinning:function(){this.transition="none 500ms ease 0s",this.lightTheme=!this.lightTheme,this.setTheme();var e=this;setTimeout((function(){e.transition="all 500ms ease 0s"}),100)},setTheme:function(){var e=document.querySelector(".simtext-dialog .el-dialog"),t=document.querySelector(".simtext-dialog .el-dialog .el-dialog__header"),i=document.querySelector(".content");this.lightTheme?(t.style.background="#e6e6e6",t.style.color="#181818",i&&i.setAttribute("data-theme","light"),e&&(e.style.background="#fff"),t&&t.setAttribute("data-theme","light")):(t.style.background="#2e2e30",t.style.color="#fff",e&&(e.style.background="#181818"),i&&i.setAttribute("data-theme","dark"),t&&t.setAttribute("data-theme","dark"))},changePreviewMode:function(){var e=this,t=this.editableTabs.findIndex((function(t){return t.name===e.editableTabsValue}));if(t>-1){var i="vditor"+t;this.$refs[i][0].setContent(this.editableValueMap.get(t))}this.previewMode=!this.previewMode,this.clickTab()},clickTab:function(){},removeTab:function(e){var t=this,i=this.editableTabs,n=this.editableTabsValue,a=0;n===e&&i.forEach((function(t,s){if(t.name===e){a=s;var o=i[s+1]||i[s-1];o&&(n=o.name)}})),this.nextActiveName=n,"Modifying"!==this.editableTabs[a].status?this.editableTabs=i.filter((function(t){return t.name!==e})):(this.removeIndex=a,this.isTabSaveDialogVisible=!0),this.editableTabsValue=n,this.abortControllerAbort(a),setTimeout((function(){t.editableTabs.length<1&&(t.hasHistoryVersion=!1,t.historyVersion={metadata:{}})}),100)}}},G=X,Q=(i("3f34"),i("2cd5"),Object(L["a"])(G,n,a,!1,null,"b5202628",null));t["a"]=Q.exports},"2fdf":function(e,t,i){},"33ed":function(e,t,i){},"3f34":function(e,t,i){"use strict";i("2fdf")},"410f":function(e,t,i){},"4c4b":function(e,t,i){},"51c9":function(e,t,i){"use strict";i("5fab")},"573f":function(e,t,i){"use strict";var n=function(){var e=this,t=e._self._c;return t("span",[e.item.shareBase?t("svg-icon",{staticClass:"share-dir",attrs:{"icon-class":"share"}}):e._e(),e._v(" "),e.strLength(e.item.folder)>e.maxNameLength?t("a",[t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:e.item.folder,placement:"top"}},[e.pathList.length>=e.maxPathCount?t("a",[e.index===e.pathList.length-e.maxPathCount-1?t("span",{staticClass:"redirect"},[e._v(" ")]):e._e(),e._v(" "),e.index===e.pathList.length-e.maxPathCount-1?t("a",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v("…"),t("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e(),e._v(" "),e.index>=e.pathList.length-e.maxPathCount-1&&e.index<e.pathList.length-1&&e.strLength(e.item.folder)<=e.maxNameLength?t("a",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v(e._s(e.item.folder)),t("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e(),e._v(" "),e.index>=e.pathList.length-e.maxPathCount-1&&e.index<e.pathList.length-1&&e.strLength(e.item.folder)>e.maxNameLength?t("span",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v(e._s(e.substring(e.item.folder,e.maxNameLength))+"…"),t("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e()]):e._e(),e._v(" "),e.pathList.length<e.maxPathCount?t("a",[e.index<e.pathList.length-1&&e.strLength(e.item.folder)<=e.maxNameLength?t("a",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v(e._s(e.item.folder)),t("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e(),e._v(" "),e.index<e.pathList.length-1&&e.strLength(e.item.folder)>e.maxNameLength?t("span",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v(e._s(e.substring(e.item.folder,e.maxNameLength))+"…"),t("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e()]):e._e(),e._v(" "),e.index===e.pathList.length-1?t("a",[e.strLength(e.item.folder)<=20?t("span",{staticClass:"no-redirect"},[e._v(e._s(e.item.folder))]):e._e(),e._v(" "),e.strLength(e.item.folder)>20&&e.strLength(e.item.folder)<=e.maxNameLengthOfLast&&e.item.searchKey?t("span",{staticClass:"no-redirect"},[e._v(e._s(e.item.folder))]):e._e(),e._v(" "),e.strLength(e.item.folder)>e.maxNameLengthOfLast&&e.item.searchKey?t("span",{staticClass:"no-redirect"},[e._v(e._s(e.substring(e.item.folder,e.maxNameLength))+"…")]):e._e(),e._v(" "),e.strLength(e.item.folder)>20&&!e.item.searchKey?t("span",{staticClass:"no-redirect"},[e._v(e._s(e.substring(e.item.folder,20))+"…")]):e._e()]):e._e()])],1):e._e(),e._v(" "),e.strLength(e.item.folder)<=e.maxNameLength?t("a",[e.pathList.length>=e.maxPathCount?t("a",[e.index===e.pathList.length-e.maxPathCount-1?t("span",{staticClass:"redirect"},[e._v(" ")]):e._e(),e._v(" "),e.index===e.pathList.length-e.maxPathCount-1?t("a",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v("…"),t("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e(),e._v(" "),e.index>e.pathList.length-e.maxPathCount-1&&e.index<e.pathList.length-1&&e.strLength(e.item.folder)<=e.maxNameLength?t("a",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v(e._s(e.item.folder)),t("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e(),e._v(" "),e.index>=e.pathList.length-e.maxPathCount-1&&e.index<e.pathList.length-1&&e.strLength(e.item.folder)>e.maxNameLength?t("span",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v(e._s(e.substring(e.item.folder,e.maxNameLength))+"…"),t("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e()]):e._e(),e._v(" "),e.pathList.length<e.maxPathCount?t("a",[e.index<e.pathList.length-1&&e.strLength(e.item.folder)<=e.maxNameLength?t("a",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v(e._s(e.item.folder)),t("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e(),e._v(" "),e.index<e.pathList.length-1&&e.strLength(e.item.folder)>e.maxNameLength?t("span",{staticClass:"redirect",on:{click:function(t){return t.preventDefault(),e.handleLink(e.item,e.index)}}},[e._v(e._s(e.substring(e.item.folder,e.maxNameLength))+"…"),t("svg-icon",{staticStyle:{"font-size":"1rem"},attrs:{"icon-class":"breadcrumb-right"}})],1):e._e()]):e._e(),e._v(" "),e.index===e.pathList.length-1?t("a",[e.strLength(e.item.folder)<=e.maxNameLength?t("span",{staticClass:"no-redirect"},[e._v(e._s(e.item.folder))]):e._e(),e._v(" "),e.strLength(e.item.folder)>e.maxNameLength&&e.strLength(e.item.folder)<=e.maxNameLengthOfLast&&e.item.searchKey?t("span",{staticClass:"no-redirect"},[e._v(e._s(e.item.folder))]):e._e(),e._v(" "),e.strLength(e.item.folder)>e.maxNameLengthOfLast&&e.item.searchKey?t("span",{staticClass:"no-redirect"},[e._v(e._s(e.substring(e.item.folder,e.maxNameLength))+"…")]):e._e(),e._v(" "),e.strLength(e.item.folder)>e.maxNameLength&&!e.item.searchKey?t("span",{staticClass:"no-redirect"},[e._v(e._s(e.substring(e.item.folder,e.maxNameLength))+"…")]):e._e()]):e._e()]):e._e()],1)},a=[],s=(i("c5f6"),i("7f29")),o={name:"BreadcrumbFilePath",props:{pathList:{type:Array,default:function(){return[]}},maxNameLength:{type:Number,default:10},maxPathCount:{type:Number,default:7},maxNameLengthOfLast:{type:Number,default:50},index:{type:Number,default:0},item:{type:Object,default:function(){return{}}}},data:function(){return{}},methods:{strLength:function(e){return Object(s["d"])(e)},substring:function(e,t){return Object(s["e"])(e,t)},handleLink:function(e,t){this.$emit("clickLink",e,t)}}},r=o,l=(i("2be3"),i("2877")),c=Object(l["a"])(r,n,a,!1,null,"4af0c46d",null);t["a"]=c.exports},"5a87":function(e,t,i){"use strict";var n=function(){var e=this,t=e._self._c;return t("div",[t("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"jmal-message-dialog",attrs:{title:e.title,visible:e.visible,modal:e.modal,top:"0vh","close-on-click-modal":!1},on:{"update:visible":function(t){e.visible=t},close:e.closeDialog}},[e.loading?e._e():t("svg-icon",{attrs:{"icon-class":"warring"}}),e._v(" "),t("span",{staticClass:"dialog-msg"},[e._v(e._s(e.content))]),e._v(" "),e.loading?e._e():t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{size:e.buttonSize},on:{click:e.operating}},[e._v(e._s(e.operatButtonText))]),e._v(" "),t("el-button",{attrs:{size:e.buttonSize,type:"primary"},on:{click:e.confirm}},[e._v(e._s(e.confirmButtonText))])],1)],1)],1)},a=[],s={name:"MessageDialog",props:{title:{type:String,default:""},modal:{type:Boolean,default:function(){return!0}},show:{type:Boolean,default:function(){return!1}},loading:{type:Boolean,default:function(){return!1}},content:{type:String,default:""},buttonSize:{type:String,default:"small"},operatButtonText:{type:String,default:""},cancelButtonText:{type:String,default:"取 消"},confirmButtonText:{type:String,default:"确 定"}},data:function(){return{visible:!1}},watch:{show:function(e){this.visible=e}},methods:{closeDialog:function(){this.$emit("update:show",this.visible)},operating:function(){this.$emit("operating")},cancel:function(){this.visible=!1,this.$emit("update:show",this.visible),this.$emit("cancel")},confirm:function(){this.$emit("confirm")}}},o=s,r=(i("d4aa"),i("2877")),l=Object(r["a"])(o,n,a,!1,null,"54abe9a1",null);t["a"]=l.exports},"5f90":function(e,t,i){},"5fab":function(e,t,i){},"60ac":function(e,t,i){"use strict";i("d353")},"657f":function(e,t,i){},7603:function(e,t,i){},"80a8":function(e,t,i){},"85a8":function(e,t,i){"use strict";i("f009")},9476:function(e,t,i){"use strict";var n=function(){var e=this,t=e._self._c;return t("div",[t("el-tree",{ref:"fileTree",attrs:{data:e.directoryTreeData,"node-key":e.localFileMode?"path":"id",props:e.directoryTreeProps,load:e.localFileMode?e.loadOfLocalFileMode:e.directoryTreeLoadNode,"highlight-current":!0,"default-expanded-keys":e.defaultExpandedKeys,"render-content":e.renderContent,hight:"100",lazy:""},on:{"node-click":e.treeNodeClick,"node-expand":e.treeNodeExpand}})],1)},a=[],s=(i("7f7f"),i("ac6a"),i("5cfc")),o=i("0dcf"),r=i("2d53"),l=i("1000"),c={name:"FileTree",components:{IconFile:o["a"],SimTextPreview:r["a"]},props:{directoryTreeData:{type:Array,default:function(){return[]}},localFileMode:{type:Boolean,default:!0},tempDir:{type:Boolean,default:!1}},data:function(){return{directoryTreeProps:{label:"name",children:"children",isLeaf:"isLeaf"}}},computed:{defaultExpandedKeys:function(){if(this.localFileMode){var e=[];return this.directoryTreeData.forEach((function(t){t.isLeaf||e.length<1&&e.push(t.path)})),e}return["0"]}},methods:{loadOfLocalFileMode:function(e,t){if(0===e.level)return t(this.directoryTreeData);e.level>0&&s["a"].listfiles({username:this.$store.state.user.name,path:encodeURI(e.data.path),tempDir:this.tempDir}).then((function(e){var i=e.data.map((function(e){return e.isLeaf=!e.isFolder,e}));return t(i)}))},directoryTreeLoadNode:function(e,t){var i=null;if(0===e.level){var n=[{id:"0",name:"全部文件"}],a=this;return setTimeout((function(){a.$refs.fileTree.setCurrentKey("0"),a.$emit("treeNodeClick",n[0])}),0),t(n)}e.level>1&&(i=e.data.id),s["a"].queryFileTree({userId:this.$store.state.user.userId,username:this.$store.state.user.name,fileId:i}).then((function(e){var i=e.data;return t(i)}))},treeNodeClick:function(e){this.$emit("treeNodeClick",e)},treeNodeExpand:function(e,t,i){},renderContent:function(e,t){var i=this,n=t.node,a=t.data;t.store;if(a.newFolder)return e("span",{class:"custom-tree-node"},[e("span",[e("svg-icon",{attrs:{"icon-class":"folder"}})]),e("span",[e("div",{class:"el-input el-input--mini el-input-tree"},[e("input",{attrs:{type:"text",autocomplete:"on",value:"新建文件夹",id:"treeInput"},class:"el-input__inner"})]),e("button",{attrs:{type:"button","element-loading-spinner":"el-icon-loading","element-loading-background":"#f6f7fa88"},on:{click:function(){var e="/",t=n.parent.data;t.path&&(e=t.path+t.name+e),s["a"].newFolder({isFolder:!0,filename:encodeURI(a.name),currentDirectory:encodeURI(e),username:i.$store.state.user.name,userId:i.$store.state.user.userId}).then((function(e){a.newFolder=!1,a.id=e.data})).catch((function(){window.event.preventDefault(),window.event.stopPropagation()}))}},class:"el-button el-icon-check el-button--mini el-input-tree-button"}),e("button",{attrs:{type:"button","element-loading-spinner":"el-icon-loading","element-loading-background":"#f6f7fa88"},on:{click:function(){i.$refs.fileTree.remove(n),window.event.preventDefault(),window.event.stopPropagation()}},class:"el-button el-icon-close el-button--mini el-input-tree-button"})])]);if(n.expanded)return e("span",{class:"custom-tree-node"},[e("svg-icon",{attrs:{"icon-class":"open-folder"}}),e("span",{style:"margin-left: 5px;"},[n.label]),e("span")]);var o=this.findIconClass(n.data);return this.localFileMode||"0"!==n.data.id||(o="folder"),e("span",{class:"custom-tree-node"},[e("svg-icon",{attrs:{"icon-class":o}}),e("span",{style:"margin-left: 5px;"},[n.label]),e("span")])},findIconClass:function(e){if(e.isFolder)return"folder";var t=e.suffix;return!t&&e.name&&(t=e.name.substring(e.name.lastIndexOf(".")+1)),l["a"].has(t)?l["a"].get(t):"file"}}},d=c,u=i("2877"),h=Object(u["a"])(d,n,a,!1,null,"c9d3b240",null);t["a"]=h.exports},a51a:function(e,t,i){"use strict";i("33ed")},a8ce:function(e,t,i){},acc1:function(e,t,i){"use strict";i("7603")},ae1f:function(e,t,i){"use strict";var n=function(){var e=this,t=e._self._c;return e.show?t("div",{staticClass:"preview"},[t("van-overlay",{attrs:{show:e.show}},[t("div",{staticClass:"wrapper"},[t("div",{staticClass:"block"},[t("div",{staticClass:"close-bar",on:{click:e.close}},[t("svg-icon",{staticClass:"audio-player-close",attrs:{"icon-class":"close"}})],1),e._v(" "),t("Artplayer",{style:e.style,attrs:{option:e.option},on:{"get-instance":e.getInstance}})],1)])])],1):e._e()},a=[],s=(i("7f7f"),i("2690")),o=function(){var e=this,t=e._self._c;return t("div",{ref:"artRef"})},r=[],l=i("6f8e"),c=i("6c96"),d=i.n(c),u={name:"Artplayer",data:function(){return{instance:null}},props:{option:{type:Object,required:!0}},mounted:function(){var e=this;this.instance=new d.a(Object(l["a"])(Object(l["a"])({},this.option),{},{container:this.$refs.artRef})),this.$nextTick((function(){e.$emit("get-instance",e.instance)}))},beforeDestroy:function(){this.instance&&this.instance.destroy&&this.instance.destroy(!1)}},h=u,f=i("2877"),m=Object(f["a"])(h,o,r,!1,null,null,null),p=m.exports,v=i("a567"),g=i("fc78"),y=i.n(g),b={name:"VideoPreview",components:{Artplayer:p},props:{file:{type:Object,default:function(){return{}}},shareId:{type:String,default:void 0},status:{type:Boolean,default:!1}},computed:{},data:function(){var e=this;return{pc:this.$pc,art:null,option:{url:"",title:"",fullscreen:!0,fullscreenWeb:this.$pc,flip:!0,playbackRate:!0,aspectRatio:!0,screenshot:!0,setting:!0,autoplay:!0,autoPlayback:!0,theme:"#23ade5",hotkey:!0,controls:[{name:"iina",position:"right",tooltip:"IINA",style:{marginRight:this.$pc?"20px":"0px",display:this.$pc?"block":"none"},html:'<a><img style="width: 1.9rem;height: 1.9rem;line-height: 1.9rem" src="'.concat(i("ed11"),'"></a>'),index:1},{name:"nplayer",position:"right",tooltip:"nPlayer",style:{marginRight:this.$pc?"20px":"0px"},html:'<a href="nplayer-videLink"><img style="width: 1.9rem;height: 1.9rem;line-height: 1.9rem" src="'.concat(i("1b2a"),'"></a>'),index:2},{name:"infuse",position:"right",tooltip:"Infuse",style:{marginRight:this.$pc?"20px":"0px"},html:'<a href="infuse://x-callback-url/play?url=videLink"><img style="width: 1.9rem;height: 1.9rem;line-height: 1.9rem" src="'.concat(i("bc1a"),'"></a>'),index:3},{name:"copyLink",position:"right",html:"复制链接",index:5,style:{marginRight:this.$pc?"20px":"0px"},click:function(){return e.copyToClipboard(e.videoLink)}}]},videoLink:"",style:{width:"100vw",height:"60vh",maxWidth:"900px",maxHeight:"600px"},show:this.status,timeout:null,playing:!1}},mounted:function(){document.addEventListener("keyup",this.escape)},destroyed:function(){document.removeEventListener("keyup",this.escape)},watch:{status:function(e){if(e){var t=s["a"].previewUrl(this.$store.state.user.name,this.file,this.$store.getters.token);this.shareId&&(t=s["a"].publicPreviewUrl(this.file,window.shareId,this.$store.getters.shareToken)),this.file.m3u8&&(t="".concat(s["a"].baseUrl,"/video/hls/").concat(this.file.m3u8),this.shareId&&(t="".concat(s["a"].baseUrl,"/public/video/hls/").concat(this.file.m3u8))),this.option.url=t,this.file.m3u8&&(this.option.customType={m3u8:this.playM3u8}),this.file.contentType.indexOf("flv")>-1&&(this.option.customType={flv:this.playFlv}),this.videoLink=window.location.origin+t,this.title=this.file.name,this.option.id=this.file.id,this.show=!0}}},methods:{copyToClipboard:function(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),t.remove(),this.$message({message:"复制成功",type:"success",duration:1e3})},escape:function(e){"Escape"===e.code&&this.close()},close:function(){this.show=!1,this.$emit("update:status",!1)},getInstance:function(e){this.art=e;var t=this.art.controls.$parent,i=t.querySelector('[data-index="1"]').querySelector("a");i.href="iina://weblink?url=".concat(this.videoLink);var n=t.querySelector('[data-index="2"]').querySelector("a"),a="nplayer-".concat(this.videoLink);n.href=a;var s=t.querySelector('[data-index="3"]').querySelector("a");s.href="infuse://x-callback-url/play?url=".concat(this.videoLink)},playM3u8:function(e,t,i){if(v["default"].isSupported()){i.hls&&i.hls.destroy();var n=new v["default"];n.loadSource(t),n.attachMedia(e),i.hls=n,i.on("destroy",(function(){return n.destroy()}))}else e.canPlayType("application/vnd.apple.mpegurl")?e.src=t:i.notice.show="Unsupported playback format: m3u8"},playFlv:function(e,t,i){if(y.a.isSupported()){i.flv&&i.flv.destroy();var n=y.a.createPlayer({type:"flv",url:t});n.attachMediaElement(e),n.load(),i.flv=n,i.on("destroy",(function(){return n.destroy()}))}else i.notice.show="Unsupported playback format: flv"}}},w=b,x=(i("60ac"),Object(f["a"])(w,n,a,!1,null,"026ddfa0",null));t["a"]=x.exports},b88e:function(e,t,i){"use strict";i("80a8")},d353:function(e,t,i){},d4aa:function(e,t,i){"use strict";i("410f")},f009:function(e,t,i){},fd35:function(e,t,i){"use strict";var n=function(){var e=this,t=e._self._c;return t("div",[t("message-dialog",{attrs:{title:"确认信息",content:"是否在关闭前保存修改？",show:e.isSaveDialogVisible,operatButtonText:"放弃修改",confirmButtonText:"保存"},on:{"update:show":function(t){e.isSaveDialogVisible=t},operating:e.closeDialog,confirm:e.saveAndClose}}),e._v(" "),e.show?t("div",{directives:[{name:"loading",rawName:"v-loading",value:!e.readyShow,expression:"!readyShow"}],staticClass:"office-preview"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.readyShow,expression:"readyShow"}],staticClass:"preview-block"},[t("div",{staticClass:"close-bar",on:{click:e.beforeClose}},[t("svg-icon",{staticClass:"preview-close",attrs:{"icon-class":"close"}})],1),e._v(" "),t("div",{staticClass:"wrapper"},["pdf"===e.fileType?t("pdf-preview",{attrs:{file:e.file,shareId:e.shareId,"file-url":e.fileUrl},on:{onReady:e.onReady}}):"drawio"===e.fileType?t("drawio",{directives:[{name:"show",rawName:"v-show",value:e.fileReday,expression:"fileReday"}],attrs:{file:e.file,shareId:e.shareId,"read-only":e.readOnly},on:{onEdit:e.onEdit,onReady:e.onReady,onClose:e.close}}):"mind"===e.fileType?t("my-mind-editor",{attrs:{file:e.file,shareId:e.shareId,"read-only":e.readOnly},on:{onEdit:e.onEdit,onReady:e.onReady,onClose:e.close}}):t("only-office-editor",{ref:"officeEditor",attrs:{file:e.file,"file-url":e.fileUrl,shareId:e.shareId,"read-only":e.readOnly},on:{onEdit:e.onEdit,manualSave:e.manualSave,onClose:e.close,onReady:e.onReady}})],1)])]):e._e()],1)},a=[],s=(i("7f7f"),i("6762"),i("2fdb"),function(){var e=this,t=e._self._c;return t("div",[t("history-popover",{ref:"historyPopover",staticStyle:{right:"20px",top:"61px",position:"absolute"},attrs:{transparent:!0,"has-history-version":e.hasHistoryVersion,"history-list-popover-visible":e.historyListPopoverVisible,"history-operation-loading":e.historyOperationLoading,saved:e.saved},on:{"update:hasHistoryVersion":function(t){e.hasHistoryVersion=t},"update:has-history-version":function(t){e.hasHistoryVersion=t},"update:historyListPopoverVisible":function(t){e.historyListPopoverVisible=t},"update:history-list-popover-visible":function(t){e.historyListPopoverVisible=t},"update:historyOperationLoading":function(t){e.historyOperationLoading=t},"update:history-operation-loading":function(t){e.historyOperationLoading=t},"update:saved":function(t){e.saved=t},viewHistoryFile:e.viewHistoryFile,recoverySuccess:e.recoverySuccess}}),e._v(" "),t("div",{staticClass:"component-only-office"},[t("div",{staticClass:"placeholder",attrs:{id:this.id}})])],1)}),o=[],r=i("1a0e"),l=(i("96cf"),i("97bf")),c=i("5cfc"),d=i("2690"),u=i("9dce"),h=i("69a0"),f=i.n(h),m=i("2edc"),p={name:"OnlyOfficeEditor",components:{HistoryPopover:m["a"]},props:{id:{type:String,default:function(){return"office_"+Math.round(1e4*Math.random())}},fileUrl:{type:String,default:""},code:{type:String,default:""},shareId:{type:String,default:""},file:{type:Object,default:function(){return{}}},readOnly:{type:Boolean,default:!1},documentKey:Function},data:function(){return{docEditorConfig:{},docEditor:null,fileKey:"",saved:!0,hasHistoryVersion:!1,historyVersion:{metadata:{}},titleObserver:null,fileHistoryDateList:[],historyListPopoverVisible:!1,historyPageIndex:1,historyPageSize:50,viewHistory:!1,historyOperationLoading:!1}},beforeDestroy:function(){this.destroyEditor()},computed:{fileType:function(){return this.getType(this.file.suffix)}},watch:{"file.id":{handler:function(e){var t=this;if(e){var i=d["a"].officeApiUrl();$J.loadScript($J.apiUrl(i),(function(e){if(null!==e)return t.$emit("onClose"),void u["a"].$emit("loadFileFaild");t.$store.state.user.token&&t.$store.state.user.userId===t.file.userId?c["a"].getFileInfoById({id:t.file.id}).then((function(e){t.file=e.data,t.loadFile()})):c["a"].getPublicFileInfoById({fileId:t.file.id,shareId:t.shareId}).then((function(e){t.file=e.data,t.loadFile()}))}))}},immediate:!0},hasHistoryVersion:function(e){if(!e){var t=document.querySelector(".component-only-office"),i=t.getElementsByTagName("iframe")[0].contentWindow.document,n=i.getElementById("box-doc-name-history-btn");n&&(n.style.display="none")}}},mounted:function(){var e=this;u["a"].$on("previewSaveAndClose",(function(){e.requestClose()}))},destroyed:function(){u["a"].$off("previewSaveAndClose")},methods:{viewHistoryFile:function(e){var t=e.historyInfo,i=window.location.origin+d["a"].previewHistoryUrl(t.id,this.$store.state.user.name,this.$store.state.user.token);this.onRequestHistoryData(null,t,i),this.historyListPopoverVisible=!1;var n=document.querySelector(".component-only-office"),a=n.getElementsByTagName("iframe")[0].contentWindow.document,s=a.getElementById("box-doc-name");if(!a.getElementById("box-doc-name-cancel-preview")){var o=document.createElement("button");o.setAttribute("id","box-doc-name-cancel-preview"),o.classList.add("btn","btn-header"),o.innerHTML="取消预览",o.style.color="#fff",o.style.width="60px",o.addEventListener("click",this.cancelPreview),s.prepend(o)}this.updateTitle(a,t)},updateTitle:function(e,t){this.historyVersion=t;var i=e.getElementById("title-doc-name");if(null===this.titleObserver){var n=this;this.titleObserver=new MutationObserver((function(e){var t=e[e.length-1].target;setTimeout((function(){t.innerHTML="历史版本: ".concat(n.historyVersion.metadata.time)}),0)}));var a={childList:!0,characterData:!0};this.titleObserver.observe(i,a)}},recoverySuccess:function(e){var t=e.result;console.log("recoverySuccess",t),this.reloadDocument("".concat(t.data,"-").concat(f.a.hash(this.file.id))),this.$message({message:"恢复成功",type:"success"}),this.historyListPopoverVisible=!1,this.historyOperationLoading=!1},cancelPreview:function(){this.reloadDocument()},reloadDocument:function(e){this.destroyEditor(),this.docEditorConfig.document.key=e||this.fileKey,this.docEditor=new DocsAPI.DocEditor(this.id,this.docEditorConfig)},onRequestHistoryData:function(e,t,i){this.docEditor.setHistoryData({fileType:this.fileType,key:"".concat(new Date(t.metadata.time).getTime(),"-").concat(f.a.hash(this.file.id)),url:i,version:t.metadata.time})},onRequestHistory:function(){this.docEditor.refreshHistory({currentVersion:"currentVersion",history:[]})},getType:function(e){switch(e){case"doc":return"docx";case"word":return"docx";case"excel":return"xlsx";case"xls":return"xlsx";case"ppt":return"pptx"}return e},loadFile:function(){var e=Object(l["a"])(Object(r["a"])().mark((function e(){var t,i,n=this;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$nextTick((function(){n.$refs.historyPopover.loadHistoryList(n.file.id)})),this.destroyEditor(),this.fileUrl=window.location.origin+d["a"].previewUrl(this.$store.state.user.name,this.file,this.$store.getters.token),this.readOnly&&window.shareId&&(this.fileUrl=window.location.origin+d["a"].publicPreviewUrl(this.file,window.shareId,this.$store.getters.shareToken)),this.fileKey="".concat(new Date(this.file.updateDate).getTime(),"-").concat(f.a.hash(this.file.id)),t=d["a"].officeCallBackUrl(this.$store.getters.token,this.$store.getters.name,this.file.id),this.docEditorConfig={document:{fileType:this.fileType,key:this.fileKey,title:this.file.name,url:this.fileUrl},editorConfig:{mode:"edit",lang:"zh",user:{id:this.$store.state.user.userId,name:this.$store.state.user.name},customization:{autosave:!1,comments:!0,compactHeader:!1,compactToolbar:!1,compatibleFeatures:!1,forcesave:!1,help:!1,hideRightMenu:!1,hideRulers:!1,submitForm:!1,about:null,feedback:!1},callbackUrl:t}},this.$pc||(this.docEditorConfig.type="mobile"),this.readOnly&&(this.docEditorConfig.editorConfig.mode="view",this.docEditorConfig.editorConfig.callbackUrl=null,this.docEditorConfig.editorConfig.user.id||(i=$J.getStorageInt("visitor"),i||(i=$J.randNum(1e3,99999),$J.setStorage("viewer",i)),this.docEditorConfig.editorConfig.user.id="visitor_"+i,this.docEditorConfig.editorConfig.user.name="Visitor_"+i)),this.docEditorConfig.events={onAppReady:this.onAppReady,onDocumentReady:this.onDocumentReady,onDocumentStateChange:this.onDocumentStateChange,onRequestHistory:this.onRequestHistory,onRequestHistoryData:this.onRequestHistoryData},this.$nextTick((function(){n.titleObserver=null,n.docEditor=new DocsAPI.DocEditor(n.id,n.docEditorConfig)}));case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onClickHistoryVersion:function(e){this.historyListPopoverVisible=!this.historyListPopoverVisible,e.stopPropagation()},onAppReady:function(){this.$emit("onReady")},onDocumentReady:function(){var e=document.querySelector(".component-only-office"),t=e.getElementsByTagName("iframe")[0].contentWindow.document;this.$pc||(e.style.top="5rem",t.querySelector(".navbar.main-navbar.navbar-with-logo").style.height="0");var n=t.querySelector(".extra .logo");n.style.display="none";var a=t.getElementById("left-btn-about");if(a.style.display="none",this.saveBtnDoc=t.getElementById("slot-btn-dt-save").getElementsByTagName("button")[0],t.getElementById("id-box-doc-name").style.paddingRight="0",this.hasHistoryVersion&&!t.getElementById("box-doc-name-history-btn")){var s=t.getElementById("box-doc-name");s.style.justifyContent="right";var o=document.createElement("button");o.classList.add("btn","btn-header"),o.setAttribute("id","box-doc-name-history-btn"),fetch(i("3b6f")).then((function(e){return e.text()})).then((function(e){var t=new DOMParser,i=t.parseFromString(e,"image/svg+xml"),n=i.querySelector("svg");n.setAttribute("style","width:16px;height:16px;"),o.appendChild(n)})),o.addEventListener("click",this.onClickHistoryVersion),t.addEventListener("click",this.$refs.historyPopover.onGlobalClick),s.appendChild(o)}},onDocumentStateChange:function(){this.saved=this.saveBtnDoc.classList.contains("disabled"),this.$emit("onEdit",this.saved)},requestClose:function(){this.$emit("manualSave")},destroyEditor:function(){null!==this.docEditor&&(this.docEditor.destroyEditor(),this.docEditor=null,this.titleObserver=null)}}},v=p,g=i("2877"),y=Object(g["a"])(v,s,o,!1,null,"2eeb7800",null),b=y.exports,w=i("5a87"),x=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"pdf-office"},[t("iframe",{ref:"pdfIframe",attrs:{name:"PDF Preview",title:e.file.name,src:e.fileUrl}})])])},T=[],C={name:"PdfPreview",props:{id:{type:String,default:function(){return"office_"+Math.round(1e4*Math.random())}},fileUrl:{type:String,default:""},file:{type:Object,default:function(){return{}}}},data:function(){return{}},mounted:function(){this.iframeLoad()},methods:{iframeLoad:function(){var e=this.$refs.pdfIframe,t=this;e.attachEvent?e.attachEvent("onload",(function(){t.$emit("onReady")})):e.onload=function(){t.$emit("onReady")}}}},_=C,k=(i("85a8"),Object(g["a"])(_,x,T,!1,null,"42b31d40",null)),S=k.exports,L=function(){var e=this,t=e._self._c;return t("div",{staticClass:"drawio-content",style:{top:e.readOnly?"0":"2.5rem"}},[t("div",{staticClass:"drawio-title"},[t("div",{staticClass:"drawio-title-name",style:{color:e.saved?e.lightTheme?"":"#ffffff":"#ff8200"}},[e._v(e._s(e.title))]),e._v(" "),t("div",{staticClass:"drawio-operation"},[t("div",{staticStyle:{"margin-right":"15px"}},[e.historyVersion.metadata.time?t("el-button",{class:e.lightTheme?"":"dark-button",attrs:{size:"mini"},on:{click:e.cancelPreview}},[e._v("取消预览")]):e._e()],1),e._v(" "),t("history-popover",{ref:"historyPopover",attrs:{"light-theme":e.lightTheme,"has-history-version":e.hasHistoryVersion,"history-list-popover-visible":e.historyListPopoverVisible,"history-operation-loading":!e.loading.closed,saved:e.saved},on:{"update:lightTheme":function(t){e.lightTheme=t},"update:light-theme":function(t){e.lightTheme=t},"update:hasHistoryVersion":function(t){e.hasHistoryVersion=t},"update:has-history-version":function(t){e.hasHistoryVersion=t},"update:historyListPopoverVisible":function(t){e.historyListPopoverVisible=t},"update:history-list-popover-visible":function(t){e.historyListPopoverVisible=t},"update:saved":function(t){e.saved=t},viewHistoryFile:e.viewHistoryFile,recoverySuccess:e.recoverySuccess}}),e._v(" "),t("div",[e.saved?e._e():t("el-button",{class:e.lightTheme?"":"dark-button",attrs:{size:"mini",loading:e.saveBtnUpdating},on:{click:e.save}},[e._v("保存")])],1)],1)]),e._v(" "),t("iframe",{ref:"myFlow",staticClass:"drawio-iframe",attrs:{src:e.url,title:e.file.name}})])},$=[],P=i("021e"),I=i("9189"),V={name:"Drawio",components:{HistoryPopover:m["a"]},props:{file:{type:Object,default:function(){return{}}},shareId:{type:String,default:""},readOnly:{type:Boolean,default:!1}},data:function(){return{url:null,bakData:"",xml:"",drawioUrlValid:!1,saveBtnUpdating:!1,title:this.file.name,saved:!0,ready:!1,currentContext:void 0,currentTitle:void 0,historyVersion:{metadata:{}},hasHistoryVersion:!1,historyListPopoverVisible:!1,viewHistory:!1,loading:{closed:!0},lightTheme:!0}},created:function(){var e="zh",t=this.readOnly?1:0,i=this.readOnly?0:1,n="kennedy",a=this.file.name?encodeURIComponent(this.file.name):"",s="?title=".concat(a,"&chrome=").concat(i,"&lightbox=").concat(t,"&ui=").concat(n,"&lang=").concat(e,"&offline=1&pwa=0&embed=1&noLangIcon=1&noExitBtn=1&noSaveBtn=1&saveAndExit=0&spin=1&proto=json");this.url=$J.apiUrl("../drawio/webapp/".concat(s))},mounted:function(){u["a"].$on("previewSaveAndClose",this.saveAndClose),window.addEventListener("message",this.handleMessage)},beforeDestroy:function(){window.removeEventListener("message",this.handleMessage)},destroyed:function(){u["a"].$off("previewSaveAndClose")},watch:{"file.id":{handler:function(e){var t=this;if(e){this.xml="";var i="previewText";this.readOnly&&(i="sharePreviewText"),c["a"][i]({shareId:this.shareId,fileId:this.file.id,id:this.file.id,fileName:this.file.name,path:encodeURI(this.file.path),username:this.$store.state.user.name,content:!0}).then(function(){var e=Object(l["a"])(Object(r["a"])().mark((function e(i){return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.checkDrawioUrl();case 2:if(t.drawioUrlValid){e.next=4;break}return e.abrupt("return");case 4:if(t.file.path=i.data.path,t.xml=i.data.contentText,t.bakData!==i.data.contentText){e.next=8;break}return e.abrupt("return");case 8:t.bakData=i.data.contentText,t.updateContent();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.$nextTick((function(){t.$refs.historyPopover.loadHistoryList(t.file.id)}))}},immediate:!0,deep:!0}},methods:{checkDrawioUrl:function(){var e=Object(l["a"])(Object(r["a"])().mark((function e(){var t=this;return Object(r["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,axios.get(this.url).then((function(e){200===e.status?t.drawioUrlValid=!0:(t.$emit("onClose"),u["a"].$emit("loadFileFaild"))})).catch((function(){t.$emit("onClose"),u["a"].$emit("loadFileFaild")}));case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),viewHistoryFile:function(e){var t=this,i=e.historyInfo,n=e.recovery;if(this.saved){var a=n?"恢复中...":"加载中...";this.loading=this.$message({iconClass:"el-icon-loading",type:"info",duration:0,dangerouslyUseHTMLString:!0,message:"<span>&nbsp;&nbsp;".concat(a,"</span>")}),I["a"].previewHistoryText({id:i.id}).then((function(e){t.loading.close(),t.historyListPopoverVisible&&(t.historyListPopoverVisible=!1),n?(t.cancelPreview(null,e.data.contentText),t.$message({message:"恢复成功",type:"success"})):(t.currentContext=t.xml,t.currentTitle=t.title,t.bakData=e.data.contentText,t.xml=e.data.contentText,t.updateContent(),t.historyVersion=i,t.title="历史版本：".concat(i.metadata.time),t.viewHistory=!0)})).catch((function(){t.loading.close()}))}else this.$message({type:"info",message:"请先保存当前修改的内容"})},recoverySuccess:function(e){var t=e.historyInfo;this.viewHistoryFile({historyInfo:t,recovery:!0})},cancelPreview:function(e,t){t||(t=this.currentContext),this.historyVersion={metadata:{}},this.xml=t,this.bakData=t,this.updateContent(),this.currentTitle&&(this.title=this.currentTitle),this.viewHistory=!1},saveAndClose:function(){this.save(),this.$emit("onClose")},updateContent:function(){this.$refs.myFlow.contentWindow.postMessage(JSON.stringify({action:"load",autosave:1,xml:this.bakData}),"*")},save:function(){this.saved||this.update(this.xml)},update:function(e){var t=this;this.saveBtnUpdating=!0,P["a"].editMarkdownByPath({relativePath:encodeURI(this.file.path+this.file.name),userId:this.$store.state.user.userId,username:this.$store.state.user.name,contentText:e}).then((function(){t.saveBtnUpdating=!1,t.saved=!0,t.title=t.file.name,t.$emit("onEdit",t.saved),t.bakData=t.xml,t.updateContent(),t.$refs.historyPopover.loadHistoryList(t.file.id)})).catch((function(){t.saveBtnUpdating=!1}))},onSwitchTheme:function(){for(var e=!1,t=this.$refs.myFlow.contentWindow.document.getElementsByTagName("link"),i=0;i<t.length;i++){var n=t[i];if(n.href.includes("styles/dark.css")){e=!0;break}}this.lightTheme=!e},handleMessage:function(e){var t=this.$refs.myFlow.contentWindow;if(e.source===t){var i=this.$refs.myFlow.contentWindow.document,n=$J.jsonParse(e.data);switch(n.event){case"init":this.ready=!0,this.$emit("onReady"),this.updateContent();var a=i.querySelector(".geMenubarContainer .geMenubar");if(a){var s=a.childNodes[5];i.addEventListener("click",this.$refs.historyPopover.onGlobalClick),s.style.display="none"}var o=i.querySelector(".geToolbarContainer");if(o){var r=o.querySelector('[title="主题"][class="geButton geAdaptiveAsset"]');r&&r.addEventListener("click",this.onSwitchTheme)}break;case"load":this.xml.length<1&&t.postMessage(JSON.stringify({action:"template"}),"*");break;case"autosave":var l=i.querySelector(".geSprite.geSprite-undo");if(l&&!this.viewHistory){var c=l.parentElement.getAttribute("class");c&&c.indexOf("mxDisabled")>-1?(this.saved=!0,this.title==="*".concat(this.file.name)&&(this.title=this.file.name)):(this.xml=n.xml,this.saved=!1,this.title="*".concat(this.file.name)),this.$emit("onEdit",this.saved)}break;case"save":this.save();break}}}}},D=V,E=(i("acc1"),Object(g["a"])(D,L,$,!1,null,"17927b2a",null)),O=E.exports,M=i("2723"),F={name:"OfficePreview",components:{Drawio:O,PdfPreview:S,MessageDialog:w["a"],OnlyOfficeEditor:b,MyMindEditor:M["a"]},props:{id:{type:String,default:function(){return"office_"+Math.round(1e4*Math.random())}},file:{type:Object,default:function(){return{}}},shareId:{type:String,default:void 0},status:{type:Boolean,default:!1}},data:function(){return{fileUrl:"",pc:this.$pc,show:this.status,readyShow:!1,readOnly:!0,isSaveDialogVisible:!1,saved:!0,previewDocument:{},delayClosing:{},fileReday:!1}},computed:{fileType:function(){return this.getType(this.file.suffix)}},mounted:function(){document.addEventListener("keyup",this.escape)},destroyed:function(){document.removeEventListener("keyup",this.escape)},watch:{status:function(e){var t=this;if(e){this.show=!0,this.$nextTick((function(){t.previewDocument=document.querySelector(".preview-block")})),this.checkReadOnly(this.file.userId);var i=this;this.delayClosing=setTimeout((function(){i.readyShow||i.loadFileFaild()}),12e3)}}},methods:{escape:function(e){"Escape"===e.code&&this.beforeClose()},getType:function(e){switch(e){case"drawio":return"drawio";case"pdf":return"pdf";case"mind":return"mind";default:return"office"}},loadFileFaild:function(){this.close(),u["a"].$emit("loadFileFaild"),this.readyShow=!0},beforeClose:function(){this.saved?this.close():this.isSaveDialogVisible=!0},close:function(){clearTimeout(this.delayClosing),this.show=!1,this.readyShow=!1,this.$emit("update:status",!1)},onReady:function(){var e=this;this.saved=!0,this.readyShow=!0,this.fileReday=!0,["drawio","office"].includes(this.fileType)&&(this.previewDocument.style.zIndex=9999,this.$nextTick((function(){var t=e;setTimeout((function(){t.previewDocument.style.zIndex=2001}),200)})))},onEdit:function(e){this.saved=e,e?window.addEventListener("onbeforeunload",this.onbeforeunload):window.removeEventListener("onbeforeunload",this.onbeforeunload)},onbeforeunload:function(e){e.returnValue="文件未保存, 确定退出吗?"},closeDialog:function(){this.isSaveDialogVisible=!1,this.close()},saveAndClose:function(){u["a"].$emit("previewSaveAndClose"),this.isSaveDialogVisible=!1},manualSave:function(){this.$message.info("请手动保存")},checkReadOnly:function(e){this.$store.state.user.token&&this.$store.state.user.userId===e&&(this.readOnly=!1),this.$pc||"office"!==this.fileType||(this.readOnly=!0,this.$nextTick((function(){var e=document.querySelector(".office-preview .close-bar");e.style.right="2.5rem",e.style.float="left",e.style.transform="rotate(225deg)"}))),this.fileUrl=window.location.origin+d["a"].previewUrl(this.$store.state.user.name,this.file,this.$store.getters.token),this.readOnly&&window.shareId&&(this.fileUrl=window.location.origin+d["a"].publicPreviewUrl(this.file,window.shareId,this.$store.getters.shareToken))}}},N=F,U=(i("b88e"),Object(g["a"])(N,n,a,!1,null,"649bc7af",null));t["a"]=U.exports},fea7:function(e,t,i){"use strict";i("4c4b")}}]);